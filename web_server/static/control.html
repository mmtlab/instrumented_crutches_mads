<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instrumented Crutches - Record</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="panel">
        <h1>Instrumented Crutches</h1>
        <nav class="navbar">
            <a href="/static/control.html" class="nav-link active">Record</a>
            <div class="nav-separator"></div>
            <a href="/static/visualization.html" class="nav-link">View Data</a>
            <div class="nav-separator"></div>
            <a href="/static/download.html" class="nav-link">Download</a>
        </nav>
        
        <div class="section">
            <h2>Acquisition</h2>
            <div class="status">
                <div>
                    <strong>Status</strong>
                    <span id="status" class="status-ready">Ready</span>
                </div>
                <div>
                    <strong>Recording ID</strong>
                    <span id="acquisition-id">None</span>
                </div>
                <div>
                    <strong>Duration</strong>
                    <span id="timer">00:00</span>
                </div>
                <div>
                    <strong>Condition</strong>
                    <span id="current-condition">-</span>
                </div>
            </div>
            <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px;">
                <button id="start-btn" class="btn btn-start">Start</button>
                <button id="stop-btn" class="btn btn-stop" disabled>Stop</button>
                <button id="condition-btn" class="btn">Condition</button>
            </div>
            <div id="feedback" class="feedback"></div>
            <div id="start-stop-feedback-container" style="margin-top: 8px;"></div>
        </div>

        <div class="section">
            <h2>Calibration</h2>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; margin-bottom: 12px;">
                <button id="offset-btn" class="btn">Calibrate</button>
                <div style="display: flex; align-items: center; gap: 20px; font-size: 14px;">
                    <div style="display: flex; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong>Left:</strong>
                            <div id="offset-left-indicator" class="offset-indicator offset-indicator-unknown">
                                <span id="offset-left" style="font-weight: 600;">NA</span>
                                <span style="font-size: 12px; font-weight: 600;">N</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong>Right:</strong>
                            <div id="offset-right-indicator" class="offset-indicator offset-indicator-unknown">
                                <span id="offset-right" style="font-weight: 600;">NA</span>
                                <span style="font-size: 12px; font-weight: 600;">N</span>
                            </div>
                        </div>
                    </div>
                    <div style="color: #64748b; font-size: 13px;">
                        <strong>last update:</strong> <span id="offset-time">—</span>
                    </div>
                </div>
            </div>
            <div id="offset-feedback-container" style="margin-top: 8px;"></div>
        </div>

        <div class="section">
            <h2>Eye-tracker</h2>
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; margin-bottom: 12px;">
                <button id="eyetracker-btn" class="btn">Connect</button>
                <div style="display: flex; align-items: center; gap: 12px; font-size: 14px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <strong>Status:</strong>
                        <span id="eyetracker-status" style="font-weight: 600; color: #64748b;">Disconnected</span>
                    </div>
                </div>
            </div>
            <div id="eyetracker-feedback-container" style="margin-top: 8px;"></div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2>Test Configuration</h2>
                <button id="toggle-config-btn" class="toggle-btn collapsed" title="Collapse/Expand">+</button>
            </div>
            <div id="config-content" class="section-content collapsed">
                <div class="form-group">
                    <label for="subject-id">Subject ID</label>
                    <input type="number" id="subject-id" class="input" placeholder="Subject ID" min="1" step="1">
                </div>
                <div class="form-group">
                    <label for="session-id">Session ID</label>
                    <input type="number" id="session-id" class="input" placeholder="Session ID" min="1" step="1">
                </div>
                <div class="form-group">
                    <label for="height-cm">Height (cm)</label>
                    <input type="number" id="height-cm" class="input" placeholder="Height" min="0">
                </div>
                <div class="form-group">
                    <label for="weight-kg">Weight (kg)</label>
                    <input type="number" id="weight-kg" class="input" placeholder="Weight" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <label for="crutch-height">Crutch Height (#hole)</label>
                    <input type="number" id="crutch-height" class="input" placeholder="Hole number" min="0">
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>Comments</h2>
                <button id="toggle-comments-btn" class="toggle-btn collapsed" title="Collapse/Expand">+</button>
            </div>
            <div id="comments-content" class="section-content collapsed">
                <div class="form-group">
                    <textarea id="comment-text" class="input" rows="3" placeholder="Write a comment here. Press Start to save it with the new recording, or use the button below to add it to the current/last recording."></textarea>
                </div>
                <button id="save-comment-btn" class="btn">Add to Current/Last</button>
                <div id="comment-feedback" class="feedback"></div>
            </div>
        </div>

        <div class="section" id="node-status-section">
            <div class="section-header">
                <h2>Status</h2>
                <button id="toggle-node-status-btn" class="toggle-btn" title="Collapse/Expand">+</button>
            </div>
            <div id="node-status-content" class="section-content">
                <div class="node-status-grid">
                    <div class="node-status-card">
                        <div class="node-status-card-title">Left Crutch (Master)</div>
                        <div class="node-status-item">
                            <div class="node-status-item-label">Controller</div>
                            <div id="status-controller" class="node-status-indicator node-status-unknown">
                                <span class="node-status-indicator-name">controller</span>
                                <span id="status-controller-state" class="node-status-indicator-state">Unknown</span>
                            </div>
                        </div>
                        <div class="node-status-item">
                            <div class="node-status-item-label">Eye-tracker</div>
                            <div id="status-eyetracker" class="node-status-indicator node-status-disconnected">
                                <span class="node-status-indicator-name">pupil_neon</span>
                                <span id="status-eyetracker-state" class="node-status-indicator-state">Disconnected</span>
                            </div>
                        </div>
                        <div class="node-status-item">
                            <div class="node-status-item-label">Logger</div>
                            <div id="status-hdf5" class="node-status-indicator node-status-unknown">
                                <span class="node-status-indicator-name">hdf5_writer</span>
                                <span id="status-hdf5-state" class="node-status-indicator-state">Unknown</span>
                            </div>
                        </div>
                        <div class="node-status-separator"></div>
                        <div class="node-status-item">
                            <div class="node-status-item-label">Tip</div>
                            <div id="tip-left" class="node-status-indicator node-status-unknown">
                                <span class="node-status-indicator-name">loadcell_left</span>
                                <span id="tip-left-state" class="node-status-indicator-state">Unknown</span>
                            </div>
                        </div>
                    </div>
                    <div class="node-status-card">
                        <div class="node-status-card-title">Right Crutch (Slave)</div>
                        <div class="node-status-item">
                            <div class="node-status-item-label">Tip</div>
                            <div id="tip-right" class="node-status-indicator node-status-unknown">
                                <span class="node-status-indicator-name">loadcell_right</span>
                                <span id="tip-right-state" class="node-status-indicator-state">Unknown</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="logo-panel">
            <img src="/static/unibs-logo-blue.png" alt="UNIBS">
            <img src="/static/mmtlab-logo-blue.png" alt="MMTLab">
            <img src="/static/unipa-logo.png" alt="UNIPA">
        </div>
    </div>

    <!-- Conditions Modal -->
    <div id="conditions-modal" class="modal">
        <div class="modal-content">
            <button id="close-conditions-btn" class="close-btn" title="Close">✕</button>
            <h1>Select Condition</h1>
            <div id="conditions-grid" class="conditions-grid"></div>
        </div>
    </div>

    <script src="/static/navbar.js"></script>
    <script src="/static/control.js"></script>
    
    <footer class="page-footer">
        <img src="/static/unibs-logo-blue.png" alt="UNIBS">
        <img src="/static/mmtlab-logo-blue.png" alt="MMTLab">
        <img src="/static/unipa-logo.png" alt="UNIPA">
    </footer>
</body>
</html>
