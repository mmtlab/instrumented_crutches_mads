#   ____                                      
#  / ___|___  _ __ ___  _ __ ___   ___  _ __  
# | |   / _ \| '_ ` _ \| '_ ` _ \ / _ \| '_ \ 
# | |__| (_) | | | | | | | | | | | (_) | | | |
#  \____\___/|_| |_| |_|_| |_| |_|\___/|_| |_|
# 


[agents]
# Settings shared by all agents
frontend_address = "tcp://localhost:9090"
backend_address = "tcp://localhost:9091"
settings_address = "tcp://localhost:9092"
compress = true
timecode_fps = 25


#  __  __                   _ _ _   _     _      
# |  \/  | ___  _ __   ___ | (_) |_| |__ (_) ___ 
# | |\/| |/ _ \| '_ \ / _ \| | | __| '_ \| |/ __|
# | |  | | (_) | | | | (_) | | | |_| | | | | (__ 
# |_|  |_|\___/|_| |_|\___/|_|_|\__|_| |_|_|\___|
#                                                

[broker]
frontend_address = "tcp://*:9090"
backend_address = "tcp://*:9091"
settings_address = "tcp://*:9092"


[logger]
mongo_uri = "mongodb://localhost:27017"
mongo_db = "mads_test"
# sub_topic = ["logger", "metadata", "rfid", "skeleton", "platform", "image", "agent_event", "bridge", "perf_assess"]
# or, subscribe to all topics:
sub_topic = [""]
max_length = 75
initially_paused = false


[bridge]
# default publish topic (if not passed via CLI)
sub_topic = ["publish"]
pub_topic = "bridge"


[feedback]
# Subscribes to ALL topics
sub_topic = [""]
print_width = 0
indent_width = 2

[metadata]
# Topic to publish to (single string!)
pub_topic = "metadata"


[perf_assess]
pub_topic = "perf_assess"

[publish]
pub_topic = "publish"

[dealer]
sub_topic = ["publish", "spawner"]
pub_topic = "dealer"
dealer_address = "tcp://*:9093"

[worker]
pub_topic = "worker"
dealer_address = "tcp://localhost:9093"


#  ____  _             _           
# |  _ \| |_   _  __ _(_)_ __  ___ 
# | |_) | | | | |/ _` | | '_ \/ __|
# |  __/| | |_| | (_| | | | | \__ \
# |_|   |_|\__,_|\__, |_|_| |_|___/
#                |___/             
#

[echoj]
# Topic to publish to (single string!)
pub_topic = "echoj"
sub_topic = ["rfid"]


[clock]
# Topic to publish to (single string!)
pub_topic = "clock"
period = 200


[monitor]
sub_topic = [""]
col_widths = [18, 15, 15]
yellow = 0.1
red = 0.1
silent = true

# --------------------------------
# --------------------------------
# Instrumented Crutches Agents
# --------------------------------
# --------------------------------

# --------------------------------
# Controllers
# --------------------------------

[web_server]
sub_topic = ["status"]
pub_topic = "ws_command"

# execution command example:
# mads-filter coordinator.plugin
[coordinator]
sub_topic = ["ws_command"]
pub_topic = "coordinator"
period = 10
test = "default"
health_status_period = 500 # ms


# execution command example:
# mads-filter status_handler.plugin
[status_handler] 
sub_topic = ["agent_event", "coordinator", "hdf5_writer", "tip_loadcell", "handle_loadcell", "imu", "pupil_neon"] # add other relevant topics to monitor (startup events, error events and shutdown events from all agents are automatically published to "agent_event" topic)
pub_topic = "status"
unreachable_agent_timeout = 3000 # ms
debug = true


# --------------------------------
# Sensors
# --------------------------------

# execution command example:
# mads-filter tip_loadcell.plugin -o side=left --dont-block
[tip_loadcell]
sub_topic = ["coordinator"]
pub_topic = "tip_loadcell"
datapin = 6
clockpin = 26
period = 10
side = "unknown" # used to select scaling factor
health_status_period = 500 # ms

[tip_loadcell.scaling]
left = 1.0 # debug value
right = 1.2 # debug value


# execution command example:
# mads-filter handle_loadcell.plugin -o side=left --dont-block
[handle_loadcell]
sub_topic = ["coordinator"]
pub_topic = "handle_loadcell"
period = 10
side = "unknown"
health_status_period = 500 # ms

# execution command example:
# mads-filter imu.plugin -o side=left --dont-block
[imu]
sub_topic = ["coordinator"]
pub_topic = "imu"
period = 10
side = "unknown"
health_status_period = 500 # ms


[pupil_neon]
sub_topic = ["coordinator"]
pub_topic = "pupil_neon"
health_status_period = 500 # ms

# --------------------------------
# HDF5 Loggers
# --------------------------------

# execution command examples:
# mads-sink hdf5_writer.plugin 
[hdf5_writer]
sub_topic = ["coordinator", "tip_loadcell", "handle_loadcell", "imu", "pupil_neon"]
pub_topic = "hdf5_writer"
folder_path = "C:/mirrorworld/instrumented_crutches/web_server/data" # provide absolute path to avoid issues with relative paths and changing working directories
keypath_sep = "."
keypaths = {"coordinator" = ["label"], "tip_loadcell" = ["side", "force"], "handle_loadcell" = ["side", "force"], "imu" = ["side", "ax", "ay", "az", "gx", "gy", "gz", "mx", "my", "mz"], "pupil_neon" = ["time_offset_ms_mean", "time_offset_ms_std", "time_offset_ms_median", "roundtrip_duration_ms_mean", "roundtrip_duration_ms_std", "roundtrip_duration_ms_median"]}
health_status_period = 500 # ms